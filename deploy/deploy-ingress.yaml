apiVersion: apps.ikubeops.com/v1
kind: KubeNova
metadata:
  name: kubenova-sample
  namespace: kube-nova
spec:
  # 全局镜像仓库配置（可选）
  imageRegistry:
    registry: "registry.cn-hangzhou.aliyuncs.com"
    organization: "kube-nova"
    tag: "latest"
    pullPolicy: Always

  # 数据库配置（必填）
  database:
    host: "mysql"
    port: 3306
    database: "kube_nova"
    user: "root"
    password: "8VlZ2lvIsKBCYSE3"
    maxOpenConns: 100
    maxIdleConns: 50
    connMaxLifetime: "30m"

  # 缓存配置（必填）
  cache:
    host: "redis"
    port: 6379
    type: "node"  # node 或 cluster
    password: "2VOSiz0vhGtxaBJb"
    tls: false
    nonBlock: true
    pingTimeout: "3s"

  # 对象存储配置（必填）
  storage:
    endpoint: "minio-service:9000"
    accessKey: "kube-nova-admin"
    secretKey: "KubeNova@2024SecretKey!"
    bucket: "kube-nova"
    endpointProxy: "http://kube-nova.ngw.ikubeops.local/storage/"
    # TLS 证书配置（可选）
    # tls:
    #   enabled: true
    #   secretName: "minio-tls-certs"  # 包含 public.crt 和 private.key

  # 链路追踪配置（可选）
  telemetry:
    enabled: true
    jaegerEndpoint: "http://jaeger-collector:14268/api/traces"
    sampler: "1.0"
    batcher: "jaeger"

  services:
    globalTimeout: 30000

    # JWT 配置（必填）
    jwt:
      accessSecret: "zk5Lp8m+0g7lvvLcnbUHPzQFEsRAmvNIn9tXdx0o80U="
      accessExpire: 86400
      refreshSecret: "zk5Lp8m+0g7lvvLcnbUHPzQFEsRAmvNIn9tXdx0o80U="
      refreshExpire: 604800
      refreshAfter: 604800

    # Portal 配置（可选）
    portal:
      name: "Kube-Nova 云原生平台"
      url: "http://kube-nova.ngw.ikubeops.local"
      demoMode: false

    # Webhook Token（可选）
    webhookToken: "mRwErqZaQVrxfyhiDQrdiQohAsONwSTtwhcmFXpCcaGavcINqorVoWINnSFFAijb"

    # 注入镜像（可选）
    injectImage: "registry.cn-hangzhou.aliyuncs.com/kube-nova/network-multitool:latest"

    # 各个服务的配置（可选，使用默认值）
    # portalAPI:
    #   enabled: true
    #   replicas: 2
    # portalRPC:
    #   enabled: true
    #   replicas: 2
    # managerAPI:
    #   enabled: true
    #   replicas: 2
    # managerRPC:
    #   enabled: true
    #   replicas: 2
    # workloadAPI:
    #   enabled: true
    #   replicas: 2
    # consoleAPI:
    #   enabled: true
    #   replicas: 2
    # consoleRPC:
    #   enabled: true
    #   replicas: 2

  # ==================================================
  # Web 前端配置（必填）
  # ==================================================
  web:
    replicas: 2
    exposeType: "ingress"
    ingress:
      className: "nginx"
      host: "kube-nova.ngw.ikubeops.local"
      tls:
        enabled: false

    minioProxy:
      enabled: true
      pathPrefix: "/storage"